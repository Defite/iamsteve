{exp:cookie:set name="css" value="true" expire="1209600"}
{!--
  {exp:cookie:set name="fonts-stage-1" value="true" expire="1209600"}
  {exp:cookie:set name="fonts-stage-2" value="true" expire="1209600"}
--}
<!DOCTYPE html>
{if '{exp:cookie:get name="fonts-stage-1"}'}
<html lang="en" class="no-js fonts-stage-1 fonts-stage-2">
{if:else}
<html lang="en" class="no-js">
{/if}
  <head>
    {!--
      Meta
      -
      Uses seo lite to manage the majority of titles and descriptions.
    --}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, viewport-fit=cover, initial-scale=1, shrink-to-fit=no">
    <meta name="p:domain_verify" content="eb06e0afbeef975e38f107fa8bcac7b5">

    {!-- PWA / performance --}
    <link rel="dns-prefetch" href="https://use.typekit.net">
    {if segment_2 == ''}
      <link rel="preload" href="{site_url}dist/fonts/averta/avertastd-bold-webfont.woff2" as="font">
      <link rel="preload" href="{site_url}dist/fonts/averta/avertastd-regularitalic-webfont.woff2" as="font">
    {if:else}
      <link rel="preload" href="{site_url}dist/fonts/averta/avertastd-bold-webfont.woff2" as="font">
      <link rel="preload" href="{site_url}dist/fonts/averta/avertastd-semibold-webfont.woff2" as="font">
      <link rel="preload" href="{site_url}dist/fonts/averta/avertastd-regularitalic-webfont.woff2" as="font">
    {/if}
    <link rel="manifest" href="{site_url}manifest.json">
    <meta name="theme-color" content="#543243">

    {!-- SEO lite --}
    {if segment_1 == ""}
      {exp:seo_lite title_override="iamsteve – design & code tutorials"}
    {if:elseif segment_1 == "about"}
      {exp:seo_lite use_last_segment="yes" default_description="About this website, why it’s about design and code, previous design versions, etc." {if embed:title}default_title="{embed:title}"{/if}}
    {if:elseif segment_1 == "contact"}
      {exp:seo_lite use_last_segment="yes" default_description="Ways of contacting me." {if embed:title}default_title="{embed:title}"{/if}}
    {if:else}
      {exp:seo_lite use_last_segment="yes" {if embed:title}default_title="{embed:title}"{/if}}
    {/if}

    {!--
      CSS
    --}
    {preload_replace:css='{exp:minimee:css minify="n" display="url"}{global:theme_url}/dist/css/global.css?v=4{/exp:minimee:css}'}
    {if global:env == "prod" || global:env == "dev"}
      {if '{exp:cookie:get name="css"}'}
        <link rel="stylesheet" href="{css}">
      {if:else}
        {if segment_2 == "entry"}
          <style>{critical_article}</style>
        {if:else}
          <style>{critical}</style>
        {/if}
        <link rel="preload" href="{css}" as="style" onload="this.rel='stylesheet'">
      {/if}
      <noscript><style>.no-js img.lazyload { display: none; }</style></noscript>
    {if:else}
      <link rel="stylesheet" href="{css}">
    {/if}

    {!--
      JS
      --

      loadCSS
      -
      Fonts from cloud.typography loaded through here async, helps load times.
      Visually complete suffers, but it‘s a reasonable trade off.
    --}
    <script>
      document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
    </script>
    <script>
      (function(d) {
        var config = {
          kitId: 'jqc3tao',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);
    </script>

    {!--
      Head
      –
      Generally don’t need to go in here. You can find JSON-LD, and other meta
      that is messy to look at, all the icons, etc.
    --}
    {head}
    {exp:iamsteve:json_ld}
    {!-- Matomo --}
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//iamsteve.me/matomo/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
  </head>
<body {if embed:class}class="{embed:class}"{/if} id="top">
