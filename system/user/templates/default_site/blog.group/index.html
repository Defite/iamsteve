{layout='layouts/_layout-blog'}

{!-- channel vars (prefix ch_) --}
{preload_replace:ch="blog"}
{preload_replace:ch_status="latest|open"}
{preload_replace:ch_disable="member_data|trackbacks"}
{preload_replace:ch_limit="12"}
{preload_replace:design="design-default-{switch='1|2|3|4'}.svg"}
{preload_replace:code="code-default-{switch='4|3|2|1'}.svg"}

<div class="row between subheader contain contain-large pb">
  {exp:stash:get_list 
    name="pagination"
    limit="1"
    process="end"
    parse_tags="yes"
    parse_vars="yes"
    parse_conditionals="yes"
  }
    <a href="{previous_page}" class="secondary-d1 sans link-icon"><span class="icon icon-medium fill-secondary-d1">{icon_arrow_left}</span> Older</a>
  
    {exp:channel:info channel="blog"}
      <h1 class="f2 secondary-d1 m-undo">{channel_title}</h1>
    {/exp:channel:info}
  
    <a href="{next_page}" class="secondary-d1 sans link-icon">Newer <span class="icon icon-medium fill-secondary-d1">{icon_arrow_right}</span></a>
  {/exp:stash:get_list}
</div>

<div class="row between contain contain-large pt-double pb-double" id="posts">
  {exp:channel:entries channel="{ch}" status="{ch_status}" disable="{ch_disable}" limit="{ch_limit}" paginate="bottom"}
  	
  	{!-- 404 --}
  	{if no_results}{redirect="404"}{/if}
  	
  	{!-- Pagination stash --}
  	{pagination}
  	
  	{!-- Article --}
  	<article data-href="{title_permalink='blog/entry'}" class="card card-medium entry">
    	<div class="card-image mb-half">
      	{if thumbnail}
      	  {thumbnail}
      	    {if medium_file_url}
      	      <img src="{url:medium}" srcset="{url:medium-2x} 2x">
            {if:else}
              <img src="{url}">
            {/if}
          {/thumbnail}
        {if:else}
      	  {categories channel="blog" limit="1"}
            {if category_id == 7}
              <img src="{site_url}dist/images/{design}">
            {if:else}
              <img src="{site_url}dist/images/{code}">
            {/if}
          {/categories}
        {/if}
    	</div>
    	<div class="card-body">
      	<div class="meta mb-half">{date}</div>
    		<h3 class="f5 f4-b mb-quarter primary"><a href="{title_permalink='blog/entry'}">{title}</a></h3>
    		{exp:streeng words="44"}{excerpt}{/exp:streeng}
    		{blog_meta}
      </div>
  	</article>
  {/exp:channel:entries}
</div>

{!-- Pagination stash is retrieved --}
{exp:stash:get_list 
  name="pagination"
  process="end"
  parse_tags="yes"
  parse_vars="yes"
  parse_conditionals="yes"
}
  <div class="row center pagination">
    {if previous_page}
      <a href="{previous_page}" class="paginate paginate-left link-icon"><span class="icon icon-medium">{icon_arrow_left}</span> Older</a>
		{if:else}
		  <span class="paginate paginate-disabled paginate-left link-icon"><span class="icon icon-medium">{icon_arrow_left}</span> Older</span>
		{/if}

		<div class="paginate paginate-between">
      <span>Page {current_page} of {total_pages}</span>
		</div>
		
		{if next_page}
			<a href="{next_page}" class="paginate paginate-right link-icon">Newer <span class="icon icon-medium">{icon_arrow_right}</span></a>
		{if:else}
		  <span class="paginate paginate-disabled paginate-right link-icon">Newer <span class="icon icon-medium">{icon_arrow_right}</span></span>
		{/if} 
  </div>
{/exp:stash:get_list}

{subscribe}