/*!
 * ExpressionEngine - by EllisLab
 *
 * @package		ExpressionEngine
 * @author		EllisLab Dev Team
<<<<<<< HEAD
 * @copyright	Copyright (c) 2003 - 2014, EllisLab, Inc.
=======
 * @copyright	Copyright (c) 2003 - 2013, EllisLab, Inc.
>>>>>>> 0fa8825dc34df02ef80cbe3b3e72c69db1cc2cc1
 * @license		http://ellislab.com/expressionengine/user-guide/license.html
 * @link		http://ellislab.com
 * @since		Version 2.6
 * @filesource
 */
<<<<<<< HEAD
!function(t){function e(e,i){this.force_empty=!!i,this.root=t(e).find(".multiselect"),this.active=t(e).find(".multiselect-active"),this.searchField=t(e).find(".multiselect-filter input"),this.root.length&&(this.activeMap={},this.listItems=this.root.find("li"),this.cache=_.map(this.root.find("label"),function(e){return t(e).text()}),this.createItem=_.template(this.active.data("template")),this.defaultList=_.object(_.range(this.listItems.length),_.map(this.listItems,t)),this.init())}function i(e,i){var n=t(e);return n.data("relationship-object")||n.data("relationship-object",i(n)),n.data("relationship-object")}e.prototype={init:function(){this._checkScrollBars(),this._disallowClickSelection(),this._bindSelectToClick(),this._bindDeselectToRemove(),this._bindAddActiveOnSelect(),this._bindScrollToActiveClick(),this._bindSortable(),this._bindSubmitClear(),this._setupFilter()},_checkScrollBars:function(){this.root.prop("scrollHeight")<=this.root.prop("clientHeight")&&this.root.removeClass("force-scroll"),this.active.prop("scrollHeight")<=this.active.prop("clientHeight")&&this.active.removeClass("force-scroll")},_bindSelectToClick:function(){var e=this;this.root.on("click","li",function(i){i.preventDefault();var n=t(this).find(":checkbox");wasChecked=n.is(":checked"),t(this).toggleClass("selected",!wasChecked),n.attr("checked",!wasChecked),_.defer(t.proxy(e.searchField,"focus"))})},_bindDeselectToRemove:function(){var t=this;this.active.on("click",".remove-item",function(){var e=t._index(this);return t.listItems.eq(e).trigger("click"),!1})},_bindScrollToActiveClick:function(){var t=this;this.active.on("click","li",function(){var e,i=t._index(this),n=t.listItems.eq(i);e=t.root.offset().top-t.root.scrollTop(),t.root.animate({scrollTop:n.offset().top-e})})},_bindAddActiveOnSelect:function(){{var e,i=this;this.listItems}if(e={activeLength:0,moveOver:function(e){var n=t(i.createItem({title:i.cache[e]}));n.data("list-index",e),i.active.find("ul").append(n),i.activeMap[e]=n,this.activeLength++,i.defaultList[e].find("input:text").val(this.activeLength)},moveBack:function(t){var e=i.defaultList[t].find("input:text").val();if(e<this.activeLength){var n=i.activeMap[t],c=n.index()+1,o=n.nextAll();o.each(function(){i.defaultList[i._index(this)].find("input:text").val(c++)})}this.activeLength--,i.defaultList[t].find("input:text").val(0),i.activeMap[t].remove(),delete i.activeMap[t]}},i.active.addClass("force-scroll"),i.force_empty)_.each(this.root.find(":checked"),function(e){var i=t(e).closest("li");i.removeClass("selected"),i.find("input:text").val(0),e.removeAttribute("checked")});else{var n=_.map(this.root.find(":checked"),function(e){var i=t(e).closest("li"),n=i.find("input:text");return[i,+n.val()]});n=_.sortBy(n,function(t){return t[1]}),_.each(n,function(t){var n=t[0],c=i.listItems.index(n);e.moveOver(c)})}i._checkScrollBars(),this.root.on("click.moveover","li",function(){i.active.addClass("force-scroll");var n=t(this).find(":checkbox"),c=i.listItems.index(this);n.is(":checked")?e.moveOver(c):e.moveBack(c),i._checkScrollBars()})},_bindSubmitClear:function(){var e=this;this.root.parents("form").on("submit",function(){return e.root.find("input:text").each(function(){"0"==t(this).val()&&t(this).remove()}),!0})},_bindSortable:function(){var t,e,i,n,c=this;e=function(t){return+c.defaultList[c._index(t)].find("input:text").val()},i=function(i,n){t=e(n.item)},n=function(e,i){var n,o,s=i.item,r=s.index()+1;r!=t&&(t>r?(o=r,n=s.nextAll().andSelf()):(o=1,n=s.prevAll().andSelf()),n.each(function(){c.defaultList[c._index(this)].find("input:text").val(o++)}))},this.active.find("ul").sortable({axis:"y",start:i,update:n})},_index:function(e){return t(e).closest("li").data("list-index")},_setupFilter:function(){var e=this.root.find("ul");this.searchField.keydown(function(t){13==t.keyCode&&t.preventDefault()}),this.searchField.on("interact",_.debounce(t.proxy(this,"_filterResults",this.defaultList,e),100))},_filterResults:function(t,e,i){this.root.addClass("force-scroll");var n=i.target.value.toLowerCase(),c=n.length;if(e.find("li").detach(),0==c)return _.each(t,function(t){t[0].style.display=""}),this._insertInOrder(e,t),this._checkScrollBars();var o=_.map(this.cache,_.partial(this._scoreString,n));_.each(t,function(t,e){t[0].style.display=0===o[e]?"none":""});var s=_.sortBy(_.range(this.cache.length),function(t){return-o[t]});this._insertInOrder(e,t,s),this._checkScrollBars()},_scoreString:function(t,e){var i=0,n=1,c=t.length;e=e.toLowerCase(),e[0]==t[0]&&(i+=1);for(var o=0;c>o;o++){var s=e.indexOf(t.charAt(o).toLowerCase());switch(s){case-1:return 0;case 0:i+=.6,o==n&&(i+=.4);break;default:i+=.4/n}n+=s,e=e.substr(s+1)}return i/c*(c/n)},_insertInOrder:function(t,e,i){i||(i=_.range(_.size(e)));var n=document.createElement("ul");_.each(i,function(t){n.appendChild(e[t][0])});var c=_.toArray(n.childNodes),o=c.length,s=0;!function r(){t.append(c.slice(s,100+s)),s+=100,o>s&&_.defer(r)}()},_disallowClickSelection:function(){var t=0,e=this;this.root.dblclick(e._deselect).click(function(){t++,_.debounce(function(){t=0},500),t>=2&&e._deselect()})},_deselect:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}},EE.setup_relationship_field=function(t){var n=document.getElementById("relationship-"+t);return i(n,function(t){return new e(t)})},Grid.bind("relationship","display",function(t){var n=t.find(".relationship");return i(n,function(){return new e(t,!t.data("row-id"))})})}(jQuery);
=======

(function(d){function i(a){this.root=d(a);this.active=d(a+"-active");this.searchField=d(a+"-filter");this.activeMap={};this.listItems=this.root.find("li");this.cache=_.map(this.root.find("label"),function(a){return d(a).text()});this.createItem=_.template(this.active.data("template"));this.defaultList=_.object(_.range(this.listItems.length),_.map(this.listItems,d));this.init()}i.prototype={init:function(){this._checkScrollBars();this._disallowClickSelection();this._bindSelectToClick();this._bindDeselectToRemove();
this._bindAddActiveOnSelect();this._bindScrollToActiveClick();this._bindSortable();this._setupFilter()},_checkScrollBars:function(){this.root.prop("scrollHeight")<=this.root.prop("clientHeight")&&this.root.removeClass("force-scroll");this.active.prop("scrollHeight")<=this.active.prop("clientHeight")&&this.active.removeClass("force-scroll")},_bindSelectToClick:function(){var a=this;this.root.on("click","li",function(b){b.preventDefault();b=d(this).find(":checkbox");wasChecked=b.is(":checked");d(this).toggleClass("selected",
!wasChecked);b.attr("checked",!wasChecked);_.defer(d.proxy(a.searchField,"focus"))})},_bindDeselectToRemove:function(){var a=this;this.active.on("click",".remove-item",function(){var b=a._index(this);a.listItems.eq(b).trigger("click");return!1})},_bindScrollToActiveClick:function(){var a=this;this.active.on("click","li",function(){var b=a._index(this),b=a.listItems.eq(b),c;c=a.root.offset().top-a.root.scrollTop();a.root.animate({scrollTop:b.offset().top-c})})},_bindAddActiveOnSelect:function(){var a=
this,b;b={activeLength:0,moveOver:function(b){var c=d(a.createItem({title:a.cache[b]}));c.data("list-index",b);a.active.find("ul").append(c);a.activeMap[b]=c;this.activeLength++;a.defaultList[b].find("input:text").val(this.activeLength)},moveBack:function(b){if(a.defaultList[b].find("input:text").val()<this.activeLength){var c=a.activeMap[b],f=c.index()+1;c.nextAll().each(function(){a.defaultList[a._index(this)].find("input:text").val(f++)})}this.activeLength--;a.defaultList[b].find("input:text").val(0);
a.activeMap[b].remove();delete a.activeMap[b]}};a.active.addClass("force-scroll");var c=_.map(this.root.find(":checked"),function(a){var a=d(a).closest("li"),b=a.find("input:text");return[a,+b.val()]}),c=_.sortBy(c,function(a){return a[1]});_.each(c,function(c){c=a.listItems.index(c[0]);b.moveOver(c)});a._checkScrollBars();this.root.on("click.moveover","li",function(){a.active.addClass("force-scroll");var c=d(this).find(":checkbox"),e=a.listItems.index(this);c.is(":checked")?b.moveOver(e):b.moveBack(e);
a._checkScrollBars()})},_bindSortable:function(){var a=this,b,c;c=function(b){return+a.defaultList[a._index(b)].find("input:text").val()};this.active.find("ul").sortable({axis:"y",start:function(a,e){b=c(e.item)},update:function(c,e){var f=e.item,d=f.index()+1,h;d!=b&&(d<b?(h=d,f=f.nextAll().andSelf()):(h=1,f=f.prevAll().andSelf()),f.each(function(){a.defaultList[a._index(this)].find("input:text").val(h++)}))}})},_index:function(a){return d(a).closest("li").data("list-index")},_setupFilter:function(){var a=
this.root.find("ul");this.searchField.keydown(function(a){13==a.keyCode&&a.preventDefault()});this.searchField.on("interact",_.debounce(d.proxy(this,"_filterResults",this.defaultList,a),100))},_filterResults:function(a,b,c){this.root.addClass("force-scroll");var c=c.target.value.toLowerCase(),d=c.length;b.find("li").detach();if(0==d)return _.each(a,function(a){a[0].style.display=""}),this._insertInOrder(b,a),this._checkScrollBars();var e=_.map(this.cache,_.partial(this._scoreString,c));_.each(a,function(a,
b){a[0].style.display=0===e[b]?"none":""});c=_.sortBy(_.range(this.cache.length),function(a){return-e[a]});this._insertInOrder(b,a,c);this._checkScrollBars()},_scoreString:function(a,b){var c=0,d=1,e=a.length,b=b.toLowerCase();b[0]==a[0]&&(c+=1);for(var f=0;f<e;f++){var g=b.indexOf(a.charAt(f).toLowerCase());switch(g){case -1:return 0;case 0:c+=0.6;f==d&&(c+=0.4);break;default:c+=0.4/d}d+=g;b=b.substr(g+1)}return c/e*(e/d)},_insertInOrder:function(a,b,c){c||(c=_.range(_.size(b)));var d=document.createElement("ul");
_.each(c,function(a){d.appendChild(b[a][0])});var e=_.toArray(d.childNodes),f=e.length,g=0;(function j(){a.append(e.slice(g++,100));g<f&&_.defer(j)})()},_disallowClickSelection:function(){var a=0,b=this;this.root.dblclick(b._deselect).click(function(){a++;_.debounce(function(){a=0},500);2<=a&&b._deselect()})},_deselect:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}};EE.setup_relationship_field=function(a){return new i(a)}})(jQuery);
>>>>>>> 0fa8825dc34df02ef80cbe3b3e72c69db1cc2cc1
